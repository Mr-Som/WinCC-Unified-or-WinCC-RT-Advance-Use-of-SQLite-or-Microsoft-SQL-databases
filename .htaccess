RewriteEngine On
RewriteBase /

# =========================
# Remove .php extension (excluding POST)
# =========================

RewriteCond %{REQUEST_METHOD} !POST [NC]
RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s([^.]+)\.php [NC]
RewriteRule ^ %1 [R=301,L]

# =========================
# Redirect /file/ → /file (remove trailing slash)
# =========================
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)/$ /$1 [R=301,L]

# =========================
# Serve .php files without extension
# /file → file.php
# =========================
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.*?)/?$ $1.php [NC,L]

# =========================
# Prevent rewrite loop for .php
# =========================
RewriteCond %{REQUEST_URI} \.php$ [NC]
RewriteRule ^ - [L]

# =========================
# Disables directory listing (no file list when no index.html) Best practice
# =========================
Options -Indexes

# =========================
# Allows symbolic links (if your project needs them)
# =========================
# Options +FollowSymLinks

# =========================
# Enables all options (Indexes, FollowSymLinks, etc.) Dangerous
# =========================
# Options All

# =========================
# SECURITY RULES (Block access .env, .htaccess, etc.) 
# ========================= 
RewriteRule ^(\.env|\.htaccess|\.gitignore|composer\.(json|lock)|package\.(json|lock)|webpack\.config\.js|yarn\.lock|vite\.config\.js)$ - [F,L,NC]

# =========================
# Route all other requests to src/index.php
# =========================
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteCond %{REQUEST_FILENAME} !-d
# RewriteRule ^(.\*)$ src/index.php [QSA,L]